<!DOCTYPE html>
<html>

<head>
    <title>详情页</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">


    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="css/detailz.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/iconfont.css">
    <script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                      <span class="sr-only">Toggle navigation</span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                    </button>
                <a class="navbar-brand" href="index.html">
                    <img alt="Brand" src="img/navbrand1.png" width="127" height="29" id="brand">
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navf" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">


                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">课程分类<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Action</a></li>
                            <li><a href="#">Another action</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">Separated link</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">One more separated link</a></li>
                        </ul>
                    </li>
                    <li><a href="#">专业</a></li>
                    <li><a href="#">关注领福利</a></li>
                </ul>
                <form class="navbar-form navbar-left">
                    <div class="input-group">

                        <input type="text" class="form-control " id="in" aria-label="...">
                        <div class="input-group-btn">
                            <button class="btn btn-default " type="submit" id="btnsec">
                                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                </button>
                        </div>
                    </div>

                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li id="back-manage"><a href="#">管理后台</a></li>
                    <li><a href="mystudy.html">我的学习</a></li>
                    <li><a href="#"><span class="glyphicon glyphicon glyphicon-bell" aria-hidden="true"></span></a></li>
                    <li><a href="cart.html"><span class="glyphicon glyphicon glyphicon-shopping-cart" aria-hidden="true"></span></a></li>
                    <li id="logging"><a href="login.html">登录/注册</a></li>
                    <li>&nbsp;&nbsp;</li>


                    <li class="aaa">

                    </li>
                    <li>&nbsp;&nbsp;</li>
                    <li id="touxiang">

                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
    <div class="detail-box ">
        <div class="detail-box-content">
            <div class="titlebar">
                <ol class="breadcrumb">
                    <li><a href="index.html">首页</a></li>

                    <li class="active">详情</li>
                </ol>
            </div>
            <div class="detail-info">
                <div class="detail-info-left">
                    <img class="img-icon" width="420px" height="250px" src="https://edu-image.nosdn.127.net/097a6c8b4383430083356493cf67b37e.jpg?imageView&quality=100&crop=0_0_439_247&thumbnail=450y250" />

                </div>
                <div class="detail-info-right">
                    <div class="detail-info-right-top">

                        <h2 class="coursename">和秋叶一起学Excel</h2>
                        <div class="down-coursename">
                            <p>
                                <sapn class="subscribenum">0</sapn>人学过
                            </p>

                            <div class="lecturer">机构/讲师：<span class="institution">幻方秋叶PPT</span></div>
                        </div>


                        <div>
                            <span class="price">￥<span class="price-num">0</span></span>
                        </div>
                    </div>
                    <div class="detail-info-right-bottom">
                        <div class="ditail-buttons">
                            <a class="join-button "><span>立即参加</span></a>

                        </div>
                    </div>
                </div>

            </div>
            <div class="page-buttons">
                <span class=" first">介绍</span>
                <span class="second selected">目录</span>

            </div>
            <div class="details-commend">
                <div class="details-direction-left">
                    <div class="direction-title">
                        <h2>目录</h2>
                    </div>
                    <div class="chapter">
                        <!-- <div class="chapter-head">
                            <span class="chapter-title">章节<span class="chapter-num">1</span></span>
                            <span class="chapter-name">【独家】【前沿】【实用】【持续更新ing】</span>
                        </div>
                        <div class="section">
                            <span class="section-body">
                            <span class="section-title">课时<span class="section-num">1</span></span>
                            <span class="section-name">【独家】【前沿】【实用】【持续更新ing】</span></span>
                            <span class="iconfont vedioicon">&#xe73b;</span>
                        </div> -->
                    </div>
                </div>
                <div class="details-commend-right">
                    <div class="institution-icon">

                        <img src="https://edu-image.nosdn.127.net/4972afc1-b324-457d-94c9-715e0264181e.jpg?imageView&quality=100&thumbnail=75y75">


                    </div>
                    <div class="institution-commend">
                        乐学偶得致力于前沿Fintech(金融科技)，Data Science(数据科学)，IT(信息科技)，企业高级管理必备CFA，FRM，CIA等高端企业管理商务知识，多语种文化艺术信息的分享及咨询。
                    </div>
                </div>

            </div>

        </div>

        <footer class="end-footer">
            <div class="footer-box">
                <div class="footer-box-left">
                    <div class="footer-box-left-first m-20">
                        <span>网易云课堂 是网易公司（163.com）旗下专注职业技能提升的在线学习平台。</span>
                    </div>
                    <div class="footer-box-left-second f-fl">
                        <div class="second-row m-20"><a href="https://study.163.com/about/aboutus.htm#/about?aboutType=1">关于我们</a></div>
                        <div class="second-row m-20"><a href="https://study.163.com/about/aboutus.htm#/about?aboutType=2">联系我们</a></div>
                        <div class="second-row m-20"><a href="https://study.163.com/about/aboutus.htm#/about?aboutType=4">帮助中心</a></div>
                        <div class="second-roww m-20"><a href="https://www.icourse163.org/">中国大学mooc</a></div>
                        <div class="second-rowww m-20"><a href="https://geek.163.com/?utm_source=study.163.com&utm_medium=web_bottombanner&utm_campaign=business&utm_content=qxq20180720">网易卡撘编程</a></div>
                        <div class="second-row m-20"><a href="https://codecombat.163.com/">极客战记</a></div>
                    </div>
                    <div class="footer-box-left-third">
                        <span>©1997-2020&nbsp&nbsp网易公司&nbsp &nbsp版权所有粤B2-20090191-18 &nbsp&nbsp工业和信息化部备案管理系统网站</span>
                    </div>
                </div>
                <div class="footter-box-right">
                    <a class="btn btn-default" role="button" id="m-yktfoot_mlogo1"></a>
                    <a class="btn btn-default" role="button" id="m-yktfoot_mlogo2"></a>
                    <div class="m-yktfoot_share">

                    </div>
                </div>
            </div>
        </footer>
    </div>
    <table style="font-size: 12px; width: 142px; display: none; " class="table" id="tab">
        <tr>
            <td><b>正在使用网易账号登录</b></td>
        </tr>

        <tr>
            <td>
                <a href="shezhi.html">设置</a>
            </td>
        </tr>

        <tr>
            <td>
                <a href="order.html">我的订单</a>
            </td>
        </tr>

        <tr>
            <td>
                <a id="zhuxiao">注销</a>
            </td>
        </tr>
    </table>
    <script src="js/navigation.js" type="text/javascript"></script>
    <script>
        function getCourseId() {
            var str = location.search;
            if (str.indexOf("?") != -1) {
                str = str.substr(1);
                var strs = str.split("=");
                str = strs[1];
            }
            return parseInt(str);
        }
        $.ajax({
            url: 'http://localhost:8080/coursedetails/display',
            data: 'courseid=' + getCourseId(),
            dataType: 'json',
            success: function(msg) {
                $(".img-icon").prop("src", msg.viewsrc);
                $(".coursename").text(msg.coursename);
                $(".subscribenum").text(msg.subscribenum);
                $(".institution").text(msg.institution.inname);
                if (msg.courseprice == 0) {
                    $(".price").replaceWith('<span class="price">免费</span>');
                } else {
                    $(".price-num").text(msg.courseprice);
                }
                if (msg.courseprice != 0) {
                    $(".ditail-buttons").append('<a class="nofee-watch"><span>免费观看</span></a><a class="join-cart"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span>加入购物车</a>');
                }

                $.ajax({
                    url: 'http://localhost:8080/myStudy/validBuyCourse',
                    data: 'courseid=' + getCourseId() + "&userid=" + sessionStorage.getItem("userid"),
                    dataType: 'text',
                    success: function(msg) {
                        if (msg.toString() == 'true') {
                            $(".ditail-buttons").replaceWith('<div class="ditail-buttons"><a class="study-button"><span>立即学习</span></a></div>');
                            $(".price").remove();
                        }

                    }
                })



                $(".institution-icon img").prop("src", msg.institution.iconsrc);
                $(".institution-commend").text(msg.institution.describe);

                var chapters = msg.chapters;
                // alert(chapters.length);
                var result = '';
                var n = 0;
                for (var i = 0; i < chapters.length; i++) {
                    var v1 = '<div class="chapter-head"><span class="chapter-title">章节<span class="chapter-num">' + (i + 1) + '</span></span><span class="chapter-name">' + chapters[i].chaptername + '</span></div>';
                    var section = '';
                    var sectionss = chapters[i].sections;

                    for (var j = 0; j < sectionss.length; j++) {

                        section += '<div class="section" data-sectionid="' + sectionss[j].id + '"><span class="section-body"><span class="section-title">课时<span class="section-num">' + (++n) + '</span></span><span class="section-name">' + sectionss[j].sectionname + '</span></span><span class="iconfont vedioicon">&#xe73b;</span></div>'
                    }
                    result += (v1 + section);
                }
                $(".chapter").append(result);
            }
        })
        $(".first").click(function() {
            window.location.href = "details.html?courseid=" + getCourseId();
        })

        //点击章节，如果免费可以免费收看全章，不免费的话判断我的是否已经购买此课程，如果已购买，可以观看任意章节，否则只能观看第一课时
        $(document).on("click", ".section", function() {
            if ($(".price").text() == '免费') {
                var sectionid = $(this).attr("data-sectionid");
                window.location.href = "player.html?sectionid=" + sectionid;
            } else {
                var t = $(this);
                $.ajax({
                    url: 'http://localhost:8080/myStudy/validBuyCourse',
                    data: 'courseid=' + getCourseId() + "&userid=" + sessionStorage.getItem("userid"),
                    dataType: 'text',
                    success: function(msg) {
                        // alert(msg);
                        if (msg == 'true') {
                            var sectionid = t.attr("data-sectionid");
                            window.location.href = "player.html?sectionid=" + sectionid;
                        } else {
                            if (t.attr("data-sectionid") == '1') {
                                var sectionid = t.attr("data-sectionid");
                                window.location.href = "player.html?sectionid=" + sectionid;
                            } else {
                                alert("未购买只能收看第一节");
                            }
                        }
                    }
                })
            }

        })

        //点击免费观看直接收看第一集
        $(document).on("click", ".nofee-watch", function() {
                var sectionid = $(this).attr("data-sectionid");
                window.location.href = "player.html?sectionid=" + sectionid;
            })
            //点击学习
        $(document).on("click", ".study-button", function() {

                window.location.href = "mystudy.html";
            })
            //添加购物车
        $(document).on("click", ".join-cart", function() {
            $.ajax({
                url: 'http://localhost:8080/cart/addOne',
                data: 'userid=' + sessionStorage.getItem("userid") + "&courseid=" + getCourseId(),
                dataType: 'text',
                success: function(msg) {
                    alert(msg);
                }
            })
        })
    </script>
</body>

</html>